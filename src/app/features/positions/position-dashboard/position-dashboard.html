<div class="position-dashboard">
  <div class="header">
    <h1>Equity Position Management System</h1>
    <div class="header-actions">
      <button (click)="refreshPositions()" [disabled]="loading" class="refresh-btn">
        <i class="refresh-icon">üîÑ</i>
        {{ loading ? 'Loading...' : 'Refresh' }}
      </button>
      <button (click)="showTransactionForm = true" class="add-transaction-btn">
        <i class="add-icon">+</i>
        Add Transaction
      </button>
    </div>
  </div>

  <div *ngIf="error" class="error-message">
    <i class="error-icon">‚ö†Ô∏è</i>
    {{ error }}
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    Loading positions...
  </div>

  <div *ngIf="!loading && !error" class="dashboard-content">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="card-icon long">üìà</div>
        <div class="card-content">
          <h3>{{ getLongPositionsCount() }}</h3>
          <p>Long Positions</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="card-icon short">üìâ</div>
        <div class="card-content">
          <h3>{{ getShortPositionsCount() }}</h3>
          <p>Short Positions</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="card-icon total">üí∞</div>
        <div class="card-content">
          <h3>{{ positions.length }}</h3>
          <p>Total Positions</p>
        </div>
      </div>
    </div>

    <!-- Positions Table -->
    <div class="positions-section">
      <h2>Current Positions</h2>
      <div *ngIf="positions.length === 0" class="no-positions">
        <i class="no-data-icon">üìä</i>
        <p>No positions found. Add some transactions to get started.</p>
      </div>
      
      <div *ngIf="positions.length > 0" class="positions-table">
        <table>
          <thead>
            <tr>
              <th>Security Code</th>
              <th>Quantity</th>
              <th>Position Type</th>
              <th>Market Value</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let position of positions" class="position-row">
              <td class="security-code">{{ position.securityCode }}</td>
              <td [class]="getQuantityClass(position.quantity)">
                {{ position.displayQuantity || position.quantity }}
              </td>
              <td>
                <span [class]="getPositionTypeClass(position.quantity)">
                  {{ getPositionType(position.quantity) }}
                </span>
              </td>
              <td class="market-value">
                {{ getMarketValue(position) | currency:'INR':'symbol':'1.0-0' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Transaction Form Modal -->
  <div *ngIf="showTransactionForm" class="modal-overlay" (click)="closeTransactionForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Add New Transaction</h3>
        <button class="close-btn" (click)="closeTransactionForm()">√ó</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addTransaction()" #transactionForm="ngForm">
          <div class="form-group">
            <label for="tradeId">Trade ID</label>
            <input type="number" id="tradeId" name="tradeId" [(ngModel)]="newTransaction.tradeId" required>
          </div>
          <div class="form-group">
            <label for="securityCode">Security Code</label>
            <input type="text" id="securityCode" name="securityCode" [(ngModel)]="newTransaction.securityCode" required>
          </div>
          <div class="form-group">
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" name="quantity" [(ngModel)]="newTransaction.quantity" required>
          </div>
          <div class="form-group">
            <label for="action">Action</label>
            <select id="action" name="action" [(ngModel)]="newTransaction.action" required>
              <option value="Insert">Insert</option>
              <option value="Update">Update</option>
              <option value="Cancel">Cancel</option>
            </select>
          </div>
          <div class="form-group">
            <label for="type">Type</label>
            <select id="type" name="type" [(ngModel)]="newTransaction.type" required>
              <option value="Buy">Buy</option>
              <option value="Sell">Sell</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" (click)="closeTransactionForm()" class="cancel-btn">Cancel</button>
            <button type="submit" [disabled]="!transactionForm.valid || addingTransaction" class="submit-btn">
              {{ addingTransaction ? 'Adding...' : 'Add Transaction' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
